@model Kanban.ViewModels.ModificarTareaViewModel
@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor
@{
    ViewData["Title"] = "Modificar tarea";
    int idUsuarioPropietario = Model.IdUsuarioPropietario; //para controlar si se puede modificar el

    var isAuthenticated = false;
    var idUsuarioLogueado = string.Empty;
    var rolUsuarioLogueado = string.Empty;

    if (HttpContextAccessor.HttpContext.Session.GetString("IsAuthenticated") == "true")
    {
        isAuthenticated = true;
        idUsuarioLogueado = HttpContextAccessor.HttpContext.Session.GetString("IdUsuarioLogueado");
        rolUsuarioLogueado = HttpContextAccessor.HttpContext.Session.GetString("RolUsuarioLogueado");
    }
}

<form asp-controller="Tarea" asp-action="ModificarTarea" method="post" class="mt-3 col-sm-7 col-md-6 col-lg-4">
    <input type="hidden" asp-for="@Model.Id">

    <fieldset>
        <legend class="text-center">Modificar tarea</legend>

        @if (Convert.ToInt32(idUsuarioLogueado) == idUsuarioPropietario || rolUsuarioLogueado == "Administrador")
        {
            <div class="mb-3">
                <label asp-for="@Model.Nombre"></label>
                <input asp-for="@Model.Nombre" class="form-control" />
                <span asp-validation-for="@Model.Nombre" class="text-danger"></span>
            </div>
            <div class="mb-3">
                <label asp-for="@Model.Descripcion"></label>
                <input asp-for="@Model.Descripcion" class="form-control" />
            </div>
            <div class="mb-3">
                <label asp-for="@Model.Color"></label>
                <select asp-for="@Model.Color" class="form-control">
                    <option value="">Ninguno</option>
                    @foreach (ColorTarea color in Enum.GetValues(typeof(ColorTarea)))
                    {
                        <option value="#@color" style="background-color: #@color;">#@color</option>
                    }
                </select>
            </div>
            <div class="mb-3">
                <label asp-for="@Model.Estado"></label>
                <select asp-for="@Model.Estado" class="form-control"
                    asp-items="Html.GetEnumSelectList<EstadoTarea>()"></select>
                <span asp-validation-for="@Model.Estado" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="@Model.IdUsuarioAsignado"></label>
                <select asp-for="@Model.IdUsuarioAsignado" class="form-control">
                    <option value="">Ninguno</option>
                    @foreach (var usuario in Model.Usuarios)
                    {
                        <option value="@usuario.Id">@usuario.NombreDeUsuario</option>
                    }
                </select>
            </div>
        }
        else
        {
            <input type="hidden" asp-for="@Model.Nombre" value="@Model.Nombre" />
            <input type="hidden" asp-for="@Model.Descripcion" value="@Model.Descripcion" />
            <input type="hidden" asp-for="@Model.Color" value="@Model.Color" />
            <input type="hidden" asp-for="@Model.IdUsuarioAsignado" value="@Model.IdUsuarioAsignado" />
            <div class="mb-3">
                <label asp-for="@Model.Estado"></label>
                <select asp-for="@Model.Estado" class="form-control"
                    asp-items="Html.GetEnumSelectList<EstadoTarea>()"></select>
                <span asp-validation-for="@Model.Estado" class="text-danger"></span>
            </div>
        }
    </fieldset>

    <div class="d-flex justify-content-center">
        <button type="submit" class="btn boton-modificar">Modificar</button>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}